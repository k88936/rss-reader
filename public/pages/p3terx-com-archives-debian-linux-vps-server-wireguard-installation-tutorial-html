
<h2 id="toc_73">前言</h2><p><a href="https://p3terx.com/go/aHR0cHM6Ly93d3cud2lyZWd1YXJkLmNvbS8" target="_blank" >WireGuard</a> 想必不用过多介绍了，目前网上的 WireGuard 教程有的是一键脚本、有的是老方法，安装慢而且会带入了一堆乱七八糟的东西，而官方文档并没有详细说明安装方法。对于 VPS 而言则还要考虑一些实际因素，不然随意安装只有报错等着你。所以博主根据实际经验写了这篇适用于通用操作系统 Debian 10+ 的 WireGuard 安装教程，适合有手动配置 WireGuard 需求的小伙伴。</p><h2 id="toc_74">准备工作</h2><ul><li><p>安装<code>sudo</code>和<code>lsb_release</code></p><pre><code>apt install sudo lsb-release -y</code></pre></li><li><p>添加 backports 源</p><pre><code>echo &quot;deb http://deb.debian.org/debian $(lsb_release -sc)-backports main&quot; | sudo tee /etc/apt/sources.list.d/backports.list
sudo apt update</code></pre></li></ul><h2 id="toc_75">安装依赖组件</h2><ul><li><p>安装必要的网络工具</p><pre><code>sudo apt install iproute2 openresolv -y</code></pre></li><li><p>安装 <strong><a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1dpcmVHdWFyZC93aXJlZ3VhcmQtdG9vbHM" target="_blank" >wireguard-tools</a></strong> (WireGuard 配置工具：<code>wg</code>、<code>wg-quick</code>)</p><pre><code>sudo apt install wireguard-tools --no-install-recommends</code></pre></li></ul><h2 id="toc_76">安装 WireGuard</h2><p>先执行<code>uname -r</code>命令查看内核版本。如果是 5.6 及以上内核则已经集成了 WireGuard ，就不需要安装了。</p><p>当然看到这篇教程的小伙伴肯定大多数都不是这个情况，因为目前 Debian 10 自带的内核版本是 4.19。所以有如下几个安装方法可供选择：</p><ol><li>安装版本高于 5.6 的内核</li><li>安装 wireguard 内核模块</li><li>安装 wireguard-go</li></ol><p>理论网络性能：<strong>内核集成</strong> ≥ <strong>内核模块</strong> ＞ <strong>wireguard-go</strong></p><p>不过并不是所有 VPS 都能随便装，最终选择还要看 VPS 所使用的虚拟化技术：</p><ul><li>KVM / HyperV / XEN HVM 等完整虚拟化的 VPS 主机，以上都是可选项，根据实际情况任选其一，后面有相关说明。</li><li>OpenVZ / LXC 等非完整虚拟化 VPS 主机，由于是共享宿主机内核，故无法对内核进行修改，就只能安装 <strong>wireguard-go</strong>。</li></ul><p>如果只要安装方便快捷，对网络性能没有极致追求，又或者对以上信息一脸懵逼，请直接移步到 <strong>安装 wireguard-go</strong> 章节。</p><h3 id="toc_77">安装新版内核</h3><p>KVM / HyperV / XEN HVM 等完整虚拟化的 VPS 主机，且能应对更换内核可能带来的不良后果则可以这个方式。</p><p>为了系统的稳定性推荐安装 backports 仓库中的内核(截止发文版本为5.9)。以下是一把梭命令：</p><pre><code>sudo apt -t $(lsb_release -sc)-backports install linux-image-$(dpkg --print-architecture) linux-headers-$(dpkg --print-architecture) --install-recommends -y</code></pre><p>安装完重启，并执行<code>uname -r</code>命令查看内核版本来确认新内核是否被启用。</p><h3 id="toc_78">安装 wireguard 内核模块</h3><p>这个安装方式博主个人并不是很推荐，对于 Linux 不熟悉的人很容易出错，尤其是使用过改内核的脚本一顿骚操作改了一些未知来源的“BBR减速内核”。</p><p>KVM / HyperV / XEN HVM 等完整虚拟化的 VPS 主机，内核版本 5.6 以下可以尝试执行以下命令安装 wireguard 动态内核模块。</p><pre><code>sudo apt install wireguard-dkms -y</code></pre><p>安装后执行<code>modprobe wireguard</code>命令加载 WireGuard 内核模块。</p><p>最后执行<code>lsmod | grep wireguard</code>命令检查是否成功加载。</p><h3 id="toc_79">安装 wireguard-go</h3><p>OpenVZ 或 LXC 的 VPS 与不想折腾内核、追求稳定的小伙伴可以安装<code>wireguard-go</code>。理论网络性能可能不及内核集成方案，不过对于正常使用而言还是绰绰有余的。</p><blockquote><strong>TIPS:</strong> 对于 OpenVZ 或 LXC 的 VPS 需要先执行<code>lsmod | grep tun</code>命令来检查 TUN/TAP 功能是否正常启用，若没有请自行咕鸽搜索开启方法，否则安装了也是不能使用的。</blockquote><p>自己编译或者使用博主写的一把梭脚本来安装已编译好的<a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC93aXJlZ3VhcmQtZ28tYnVpbGRlci9yZWxlYXNlcy9sYXRlc3Q" target="_blank" >最新稳定版<code>wireguard-go</code>二进制文件</a>：</p><pre><code>curl -fsSL git.io/wireguard-go.sh | sudo bash</code></pre><h2 id="toc_80">尾巴</h2><p>安装完成你就可以开始你的 WireGuard 折腾之旅了。</p><hr><p>本博客已开设 <a href="https://p3terx.com/go/aHR0cHM6Ly90Lm1lL1AzVEVSWF9aT05F" target="_blank" >Telegram 频道</a>，欢迎小伙伴们订阅关注。</p>
