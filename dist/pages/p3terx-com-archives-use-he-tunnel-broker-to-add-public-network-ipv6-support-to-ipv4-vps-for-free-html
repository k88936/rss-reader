
<p><figure><img class="" alt="" data-src="https://imgcdn.p3terx.com/post/20210225051254.jpg" src="https://imgcdn.p3terx.com/post/20210225051254.jpg"></figure></p><h2 id="toc_81">前言</h2><p><a href="https://p3terx.com/go/aHR0cHM6Ly9oZS5uZXQ" target="_blank" >Hurricane Electric</a> (简称：HE) 是一家位于美国的全球互联网服务提供商。该公司运营了世界上以对等数最大 IPv6 网络，同时也提供免费的 IPv6 隧道服务，其隧道服务可以追溯到 2001 年。虽然经过多年的发展 IPv6 已经相当普及，但依然还是有部分 VPS 商家由于各种各样的原因没有给 VPS 标配 IPv6 地址，有的需要加钱、有的甚至不给加钱。如果此时有访问 IPv6 网络的需求，就可以接入 HE Tunnel Broker 提供的 IPv6 隧道免费给 IPv4 VPS 主机添加公网 IPv6 地址来获得 IPv6 网络的访问能力。</p><h2 id="toc_82">HE IPv6 隧道的使用场景与局限性</h2><p>使用场景：</p><ul><li>给 VPS 服务器、家用设备接入 IPv6 公网访问能力</li><li>使 IPv4 VPS 可访问 IPv6 网络，比如给 IPv6 Only VPS 做 SSH 跳板</li><li><p>HE IPv6 地址可绕过部分网站的 IP 访问限制：</p><ul><li>解锁 Netflix 非自制剧 (已失效)</li><li>解锁 ChatGPT 访问限制 (只验证可访问，未验证是否稳定不封号)</li></ul></li></ul><p>局限性：</p><ul><li>无法使用 HE 提供的 IPv6 公网 IP 接入 Cloudflare CDN 。</li><li><p>滥用严重，IP 评分机构标记为高风险。使用 HE IPv6 访问网站会遇到以下问题：</p><ul><li>部分网站为了防止资源滥用，可能会限制访问、频繁弹人机验证、无法注册。</li><li>银行、购物等安全要求高的网站可能会判定为欺诈行为、导致砍单，严重会导致封号。</li></ul></li></ul><h2 id="toc_83">HE Tunnel Broker 设置教程</h2><h3 id="toc_84">创建 Tunnel Broker IPv6 隧道</h3><ul><li>注册 <a href="https://p3terx.com/go/aHR0cHM6Ly93d3cudHVubmVsYnJva2VyLm5ldA" target="_blank" >Tunnel Broker</a> 账号</li><li>点击左侧的<code>Create Regular Tunnel</code>(创建常规隧道)</li><li>输入 VPS 的公网 IP 地址</li><li>根据 VPS 的位置选择一个合适的节点</li><li>页面拉到最下方，点击<code>Create Tunnel</code>(创建隧道)</p><p><figure><img class="" alt="" data-src="https://imgcdn.p3terx.com/post/20210214034651.png#vwid=849&vhei=722" src="https://imgcdn.p3terx.com/post/20210214034651.png#vwid=849&vhei=722"></figure></li><li>在 <strong>Tunnel Details</strong> 页面可以看到创建的 IPv6 隧道的详细信息，其中 <strong>Client IPv6 Address</strong> 是申请到公网 IPv6 地址。</p><p><figure><img class="" alt="" data-src="https://imgcdn.p3terx.com/post/20210214040003.png#vwid=661&vhei=633" src="https://imgcdn.p3terx.com/post/20210214040003.png#vwid=661&vhei=633"></figure></li></ul><h3 id="toc_85">获取配置示例</h3><p>在 <strong>Tunnel Details</strong> 页面有个 <strong>Example Configuration</strong> 选项卡，在这里你可以选择合适的配置示例。就比如这里有 Debian/Ubuntu 的<code>interfaces</code>配置文件示例：</p><p><figure><img class="" alt="" data-src="https://imgcdn.p3terx.com/post/20210214040002.png#vwid=662&vhei=478" src="https://imgcdn.p3terx.com/post/20210214040002.png#vwid=662&vhei=478"></figure></p><p>只要基于 Debian 的发行版和使用<code>interfaces</code>配置文件的系统理论上都可以使用。其它不兼容的发行版则可以使用 <strong>Linux-net-tools</strong> 或 <strong>Linux-route2</strong> 示例手动输入命令。</p><p>由于博主使用的是 Debian ，所以后面只会讲 Debian 系发行版的详细操作步骤。<del>不会真的有人在用 CentOS 吧？</del></p><h3 id="toc_86">添加 IPv6 网络接口</h3><p>将<code>he-ipv6</code>配置文件添加到<code>/etc/network/interfaces.d/</code>目录下。下面是一把梭命令示例，根据实际情况替换文本。</p><pre><code class="lang-bash">sudo tee /etc/network/interfaces.d/he-ipv6 &lt;&lt;EOF
auto he-ipv6
iface he-ipv6 inet6 v4tunnel
        address 2001:xxx:xxxx:xxxx::2
        netmask 64
        endpoint 216.66.84.46
        local 233.xxx.xxx.233
        ttl 255
        gateway 2001:xxx:xxxx:xxxx::1
EOF</code></pre><blockquote><strong>TIPS:</strong> 如果是 NAT VPS 或 VPC 内网方案则需要将<code>local</code>字段后面的公网 IP 替换为内网 IP 。获取命令：<code>ip route get 8.8.8.8 | grep -oP 'src \K\S+'</code>。</blockquote><h3 id="toc_87">启用 IPv6 隧道</h3><ul><li><p>安装网络工具包</p><pre><code class="lang-bash">sudo apt update
sudo apt install net-tools iproute2 -y</code></pre></li><li><p>启动<code>he-ipv6</code>网络接口</p><pre><code class="lang-bash">sudo ifup he-ipv6</code></pre><blockquote><strong>TIPS</strong>：若提示 <strong>ifup: unknown interface he-ipv6</strong> ，则添加<code>source /etc/network/interfaces.d/*</code>到<code>/etc/network/interfaces</code>文件（一把梭命令：<code>echo 'source /etc/network/interfaces.d/*' &gt;&gt;/etc/network/interfaces</code>）后重试，正常情况下无输出。</blockquote></li><li><p>启用后执行<code>ifconfig</code>命令，这时应该有一个<code>he-ipv6</code>接口，类似下面这样：</p><pre><code class="lang-txt">he-ipv6: flags=209&lt;UP,POINTOPOINT,RUNNING,NOARP&gt;  mtu 1480
          inet6 2001:xxx:xxxx:xxxx::2  prefixlen 64  scopeid 0x0&lt;global&gt;
          inet6 fe80::xxxx:xxxx  prefixlen 64  scopeid 0x20&lt;link&gt;
          sit  txqueuelen 1000  (IPv6-in-IPv4)
          RX packets 11605  bytes 3127821 (3.1 MB)
          RX errors 0  dropped 0  overruns 0  frame 0
          TX packets 13811  bytes 2403522 (2.4 MB)
          TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</code></pre></li><li><p>若没有生效可以尝试重启网络</p><pre><code class="lang-bash">sudo systemctl restart networking</code></pre></li></ul><h2 id="toc_88">其它操作</h2><h3 id="toc_89">检测 IPv6 支持</h3><p>执行<code>ping6 google.com</code>命令，能 ping 通说明 VPS 已经支持 IPv6 网络了。</p><h3 id="toc_90">NAT VPS 的额外设置</h3><p>IPv4 NAT VPS 除了前面提到的替换 IP 操作以外，可能还需要一些额外的设置，否则可能还是无法访问 IPv6 网络。</p><ul><li><p>配置防火墙允许 41 端口入站</p><pre><code class="lang-bash">ufw allow 41</code></pre></li><li><p>添加相关的路由规则</p><pre><code class="lang-bash">route -A inet6 add ::/0 dev he-ipv6</code></pre></li></ul><h3 id="toc_91">DNS 设置优化</h3><blockquote><strong>TIPS:</strong> 以下设置仅针对操作系统 DNS ，代理软件应单独设置内置的 DNS 和 IP 分流策略，具体参考相关软件文档中的 DNS 和路由部分。</blockquote><h4 id="toc_92">选择合适的 DNS 解析服务器</h4><p>因为通过 IPv6 隧道去请求可能会拖慢 DNS 解析速度，所以一般不建议在系统中使用 IPv6 地址的 DNS。</p><p>编辑<code>/etc/resolv.conf</code>文件，更改 DNS 解析服务器为支持查询 AAAA 记录的 DNS 服务器，比如 <a href="https://p3terx.com/go/aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vc3BlZWQvcHVibGljLWRucw" target="_blank" >Google Public DNS</a>。</p><pre><code class="lang-txt">nameserver 8.8.8.8
nameserver 8.8.4.4</code></pre><h4 id="toc_93">优先使用 IPv4 网络</h4><p>默认情况下 IPv6 网络优先级会高于 IPv4 ，为了防止 IPv6 隧道拖慢 VPS 的正常网速，可以设置优先使用 IPv4 网络。同时也能减轻了对 HE Tunnel Broker 节点的网络压力，合理使用宝贵的免费资源。</p><p>编辑<code>/etc/gai.conf</code>文件，在末尾添加下面这行配置：</p><pre><code class="lang-txt">precedence  ::ffff:0:0/96   100</code></pre><p>一键添加命令如下：</p><pre><code class="lang-bash">echo 'precedence  ::ffff:0:0/96   100' | sudo tee -a /etc/gai.conf</code></pre><p>完事执行<code>curl ip.p3terx.com</code>命令，显示 VPS 的 IPv4 地址则代表成功。</p><h3 id="toc_94">删除 HE IPv6 隧道</h3><p>不想用了，或者想使用其它方式访问 IPv6 网络时，记得先删除。</p><ul><li><p>停用隧道</p><pre><code class="lang-bash">sudo ifdown he-ipv6</code></pre></li><li><p>删除<code>he-ipv6</code>网络接口配置文件（若没有删除重启后会自动启用）</p><pre><code class="lang-bash">sudo rm -f /etc/network/interfaces.d/he-ipv6</code></pre></li></ul><hr><h2 id="toc_95">相关推荐</h2><ul><li>《<a href="https://p3terx.com/archives/use-cloudflare-warp-to-add-extra-ipv4-or-ipv6-network-support-to-vps-servers-for-free.html" target="_blank" >使用 Cloudflare WARP 给 VPS 服务器免费添加 IPv4 或 IPv6 网络支持</a>》</li><li>《<a href="https://p3terx.com/archives/cheap-and-costeffective-vps-recommended.html" target="_blank" >国外便宜高性价比和免费白嫖 VPS 推荐</a>》</li><li>《<a href="https://p3terx.com/archives/cheap-vps-recommended-chatgpt.html" target="_blank" >可访问 ChatGPT 的便宜 VPS 推荐</a>》</li></ul><hr><p>本博客已开设 <a href="https://p3terx.com/go/aHR0cHM6Ly90Lm1lL1AzVEVSWF9aT05F" target="_blank" >Telegram 频道</a>，欢迎小伙伴们订阅关注。</p>
